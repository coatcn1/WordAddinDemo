/*! For license information please see taskpane.js.LICENSE.txt */
!function(){"use strict";var t={58394:function(t,e,r){t.exports=r.p+"d8108e96be0210d8bc62.css"}},e={};function r(n){var o=e[n];if(void 0!==o)return o.exports;var a=e[n]={exports:{}};return t[n](a,a.exports,r),a.exports}r.m=t,r.d=function(t,e){for(var n in e)r.o(e,n)&&!r.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},function(){var t;r.g.importScripts&&(t=r.g.location+"");var e=r.g.document;if(!t&&e&&(e.currentScript&&"SCRIPT"===e.currentScript.tagName.toUpperCase()&&(t=e.currentScript.src),!t)){var n=e.getElementsByTagName("script");if(n.length)for(var o=n.length-1;o>-1&&(!t||!/^http(s?):/.test(t));)t=n[o--].src}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),r.p=t}(),r.b=document.baseURI||self.location.href,function(){function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t(e)}function e(){e=function(){return n};var r,n={},o=Object.prototype,a=o.hasOwnProperty,i=Object.defineProperty||function(t,e,r){t[e]=r.value},c="function"==typeof Symbol?Symbol:{},u=c.iterator||"@@iterator",s=c.asyncIterator||"@@asyncIterator",l=c.toStringTag||"@@toStringTag";function f(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{f({},"")}catch(r){f=function(t,e,r){return t[e]=r}}function h(t,e,r,n){var o=e&&e.prototype instanceof b?e:b,a=Object.create(o.prototype),c=new T(n||[]);return i(a,"_invoke",{value:j(t,r,c)}),a}function p(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}n.wrap=h;var y="suspendedStart",v="suspendedYield",d="executing",m="completed",g={};function b(){}function w(){}function x(){}var E={};f(E,u,(function(){return this}));var L=Object.getPrototypeOf,k=L&&L(L(A([])));k&&k!==o&&a.call(k,u)&&(E=k);var S=x.prototype=b.prototype=Object.create(E);function I(t){["next","throw","return"].forEach((function(e){f(t,e,(function(t){return this._invoke(e,t)}))}))}function O(e,r){function n(o,i,c,u){var s=p(e[o],e,i);if("throw"!==s.type){var l=s.arg,f=l.value;return f&&"object"==t(f)&&a.call(f,"__await")?r.resolve(f.__await).then((function(t){n("next",t,c,u)}),(function(t){n("throw",t,c,u)})):r.resolve(f).then((function(t){l.value=t,c(l)}),(function(t){return n("throw",t,c,u)}))}u(s.arg)}var o;i(this,"_invoke",{value:function(t,e){function a(){return new r((function(r,o){n(t,e,r,o)}))}return o=o?o.then(a,a):a()}})}function j(t,e,n){var o=y;return function(a,i){if(o===d)throw Error("Generator is already running");if(o===m){if("throw"===a)throw i;return{value:r,done:!0}}for(n.method=a,n.arg=i;;){var c=n.delegate;if(c){var u=_(c,n);if(u){if(u===g)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===y)throw o=m,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=d;var s=p(t,e,n);if("normal"===s.type){if(o=n.done?m:v,s.arg===g)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(o=m,n.method="throw",n.arg=s.arg)}}}function _(t,e){var n=e.method,o=t.iterator[n];if(o===r)return e.delegate=null,"throw"===n&&t.iterator.return&&(e.method="return",e.arg=r,_(t,e),"throw"===e.method)||"return"!==n&&(e.method="throw",e.arg=new TypeError("The iterator does not provide a '"+n+"' method")),g;var a=p(o,t.iterator,e.arg);if("throw"===a.type)return e.method="throw",e.arg=a.arg,e.delegate=null,g;var i=a.arg;return i?i.done?(e[t.resultName]=i.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=r),e.delegate=null,g):i:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,g)}function N(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function P(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function T(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(N,this),this.reset(!0)}function A(e){if(e||""===e){var n=e[u];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function t(){for(;++o<e.length;)if(a.call(e,o))return t.value=e[o],t.done=!1,t;return t.value=r,t.done=!0,t};return i.next=i}}throw new TypeError(t(e)+" is not iterable")}return w.prototype=x,i(S,"constructor",{value:x,configurable:!0}),i(x,"constructor",{value:w,configurable:!0}),w.displayName=f(x,l,"GeneratorFunction"),n.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===w||"GeneratorFunction"===(e.displayName||e.name))},n.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,x):(t.__proto__=x,f(t,l,"GeneratorFunction")),t.prototype=Object.create(S),t},n.awrap=function(t){return{__await:t}},I(O.prototype),f(O.prototype,s,(function(){return this})),n.AsyncIterator=O,n.async=function(t,e,r,o,a){void 0===a&&(a=Promise);var i=new O(h(t,e,r,o),a);return n.isGeneratorFunction(e)?i:i.next().then((function(t){return t.done?t.value:i.next()}))},I(S),f(S,l,"Generator"),f(S,u,(function(){return this})),f(S,"toString",(function(){return"[object Generator]"})),n.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},n.values=A,T.prototype={constructor:T,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=r,this.done=!1,this.delegate=null,this.method="next",this.arg=r,this.tryEntries.forEach(P),!t)for(var e in this)"t"===e.charAt(0)&&a.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=r)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function n(n,o){return c.type="throw",c.arg=t,e.next=n,o&&(e.method="next",e.arg=r),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],c=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var u=a.call(i,"catchLoc"),s=a.call(i,"finallyLoc");if(u&&s){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!s)throw Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&a.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var o=n;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var i=o?o.completion:{};return i.type=t,i.arg=e,o?(this.method="next",this.next=o.finallyLoc,g):this.complete(i)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),g},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),P(r),g}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;P(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(t,e,n){return this.delegate={iterator:A(t),resultName:e,nextLoc:n},"next"===this.method&&(this.arg=r),g}},n}function n(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=o(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,a=function(){};return{s:a,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,c=!0,u=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return c=t.done,t},e:function(t){u=!0,i=t},f:function(){try{c||null==r.return||r.return()}finally{if(u)throw i}}}}function o(t,e){if(t){if("string"==typeof t)return a(t,e);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?a(t,e):void 0}}function a(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}function i(t,e,r,n,o,a,i){try{var c=t[a](i),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function c(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var a=t.apply(e,r);function c(t){i(a,n,o,c,u,"next",t)}function u(t){i(a,n,o,c,u,"throw",t)}c(void 0)}))}}function u(){return s.apply(this,arguments)}function s(){return s=c(e().mark((function t(){return e().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,Word.run(function(){var t=c(e().mark((function t(r){var n,o,a,i,c;return e().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return(n=r.document.getSelection()).load("text"),t.next=4,r.sync();case 4:if(""!==(o=n.text.trim())){t.next=14;break}return log("未选择文本，默认获取全文内容"),(a=r.document.body).load("text"),t.next=11,r.sync();case 11:o=a.text,t.next=15;break;case 14:log("获取选定的文本，长度: ".concat(o.length," 字符"));case 15:return i=parseInt(localStorage.getItem("chunkSize"),10)||800,log("使用的字符数设置为 ".concat(i)),c=l(o,i),log("文本已分割成 ".concat(c.length," 个片段")),t.abrupt("return",c);case 20:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}());case 3:return t.abrupt("return",t.sent);case 6:throw t.prev=6,t.t0=t.catch(0),log("获取文档内容失败: ".concat(t.t0.message)),t.t0;case 10:case"end":return t.stop()}}),t,null,[[0,6]])}))),s.apply(this,arguments)}function l(t,e){var r,i,c=[],u="",s=n(t.split("\n"));try{for(s.s();!(r=s.n()).done;){var l=r.value;if((u+"\n"+l).length<=e)u+=(u?"\n":"")+l;else if(u&&c.push(u),l.length>e){var h=f(l,e);c.push.apply(c,function(t){if(Array.isArray(t))return a(t)}(i=h)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(i)||o(i)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),u=""}else u=l}}catch(t){s.e(t)}finally{s.f()}return u&&c.push(u),c}function f(t,e){var r,o=[],a="",i=n(t.match(/[^.!?]+[.!?]*/g)||[t]);try{for(i.s();!(r=i.n()).done;){var c=r.value;if((a+" "+c).length<=e)a+=(a?" ":"")+c;else if(a&&o.push(a),c.length>e){for(var u=0;u<c.length;u+=e)o.push(c.substring(u,u+e));a=""}else a=c}}catch(t){i.e(t)}finally{i.f()}return a&&o.push(a),o}function h(t,e,r){return p.apply(this,arguments)}function p(){return(p=c(e().mark((function t(r,o,a){var i,c,u,s,l,f,h,p,y,v,d,m,g,b,w,x,E,L,k,S,I,O;return e().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:t.prev=0,log("处理问题: ".concat(JSON.stringify(r))),i=!1,c=new Set,t.prev=4,u=[r.text,r.text.replace(/\t/g," "),r.text.replace(/\t/g,"   "),r.text.replace(/[\t\s]+/g," ")],log("尝试以下搜索变体:"),u.forEach((function(t,e){log("变体 ".concat(e+1,': "').concat(t,'"'))})),s=0,l=u;case 9:if(!(s<l.length)){t.next=42;break}return f=l[s],h=o.search(f,{matchCase:!1,matchWholeWord:!1}),a.load(h),t.next=15,a.sync();case 15:if(!(h.items.length>0)){t.next=39;break}log('找到完整匹配，使用文本: "'.concat(f,'"')),i=!0,p=n(h.items),t.prev=19,p.s();case 21:if((y=p.n()).done){t.next=30;break}return(v=y.value).load("start"),t.next=26,a.sync();case 26:d="".concat(v.start),c.has(d)||(c.add(d),m="错误说明：".concat(r.comment,"\n")+"扣分：".concat(r.score," 分\n")+"违反规则：".concat(r.rule),log("在位置 ".concat(d," 添加批注: ").concat(m)),v.insertComment(m));case 28:t.next=21;break;case 30:t.next=35;break;case 32:t.prev=32,t.t0=t.catch(19),p.e(t.t0);case 35:return t.prev=35,p.f(),t.finish(35);case 38:return t.abrupt("break",42);case 39:s++,t.next=9;break;case 42:if(i){t.next=88;break}log("完整匹配失败，尝试分段匹配"),g=r.text.split(/[\t\s]+/).filter(Boolean),log("分段搜索以下部分: ".concat(JSON.stringify(g))),b=n(g),t.prev=47,b.s();case 49:if((w=b.n()).done){t.next=80;break}return x=w.value,E=o.search(x,{matchCase:!1,matchWholeWord:!0}),a.load(E),t.next=55,a.sync();case 55:if(!(E.items.length>0)){t.next=78;break}log('找到部分匹配: "'.concat(x,'"')),i=!0,L=n(E.items),t.prev=59,L.s();case 61:if((k=L.n()).done){t.next=70;break}return(S=k.value).load("start"),t.next=66,a.sync();case 66:I="".concat(S.start),c.has(I)||(c.add(I),O="错误说明：".concat(r.comment,"\n")+"扣分：".concat(r.score," 分\n")+"违反规则：".concat(r.rule),log("在位置 ".concat(I," 添加批注: ").concat(O)),S.insertComment(O));case 68:t.next=61;break;case 70:t.next=75;break;case 72:t.prev=72,t.t1=t.catch(59),L.e(t.t1);case 75:return t.prev=75,L.f(),t.finish(75);case 78:t.next=49;break;case 80:t.next=85;break;case 82:t.prev=82,t.t2=t.catch(47),b.e(t.t2);case 85:return t.prev=85,b.f(),t.finish(85);case 88:t.next=93;break;case 90:t.prev=90,t.t3=t.catch(4),log("搜索过程出错: ".concat(t.t3.message));case 93:return t.next=95,a.sync();case 95:return t.abrupt("return",i);case 98:return t.prev=98,t.t4=t.catch(0),log("处理问题时出错: ".concat(t.t4.message)),t.abrupt("return",!1);case 102:case"end":return t.stop()}}),t,null,[[0,98],[4,90],[19,32,35,38],[47,82,85,88],[59,72,75,78]])})))).apply(this,arguments)}function y(t){return y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},y(t)}function v(t){j("=== 开始解析 AI 响应 ===");try{if("object"===y(t))return t;var e=t.match(/\{[\s\S]*\}/);if(!e)throw new Error("未找到 JSON 格式的内容");var r,n=e[0];j("成功提取 JSON 内容"),n=n.replace(/[\u0000-\u001F\u007F-\u009F]/g,"").replace(/\t/g," ").trim();try{r=JSON.parse(n)}catch(t){throw j("JSON 解析失败"),j("错误消息: ".concat(t.message)),t}if(!r.issues||"number"!=typeof r.totalScore)throw new Error("JSON 内容缺少必要的字段 'issues' 或 'totalScore'");return r}catch(e){throw j("=== AI 响应解析失败 ==="),j("错误类型: ".concat(e.constructor.name)),j("错误消息: ".concat(e.message)),j("AI 响应内容:\n".concat(t)),e}}function d(t){return d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},d(t)}function m(){m=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",c=a.asyncIterator||"@@asyncIterator",u=a.toStringTag||"@@toStringTag";function s(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var a=e&&e.prototype instanceof b?e:b,i=Object.create(a.prototype),c=new T(n||[]);return o(i,"_invoke",{value:j(t,r,c)}),i}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var h="suspendedStart",p="suspendedYield",y="executing",v="completed",g={};function b(){}function w(){}function x(){}var E={};s(E,i,(function(){return this}));var L=Object.getPrototypeOf,k=L&&L(L(A([])));k&&k!==r&&n.call(k,i)&&(E=k);var S=x.prototype=b.prototype=Object.create(E);function I(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function O(t,e){function r(o,a,i,c){var u=f(t[o],t,a);if("throw"!==u.type){var s=u.arg,l=s.value;return l&&"object"==d(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,i,c)}),(function(t){r("throw",t,i,c)})):e.resolve(l).then((function(t){s.value=t,i(s)}),(function(t){return r("throw",t,i,c)}))}c(u.arg)}var a;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return a=a?a.then(o,o):o()}})}function j(e,r,n){var o=h;return function(a,i){if(o===y)throw Error("Generator is already running");if(o===v){if("throw"===a)throw i;return{value:t,done:!0}}for(n.method=a,n.arg=i;;){var c=n.delegate;if(c){var u=_(c,n);if(u){if(u===g)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=v,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=y;var s=f(e,r,n);if("normal"===s.type){if(o=n.done?v:p,s.arg===g)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(o=v,n.method="throw",n.arg=s.arg)}}}function _(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,_(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),g;var a=f(o,e.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,g;var i=a.arg;return i?i.done?(r[e.resultName]=i.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,g):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,g)}function N(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function P(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function T(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(N,this),this.reset(!0)}function A(e){if(e||""===e){var r=e[i];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,a=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return a.next=a}}throw new TypeError(d(e)+" is not iterable")}return w.prototype=x,o(S,"constructor",{value:x,configurable:!0}),o(x,"constructor",{value:w,configurable:!0}),w.displayName=s(x,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===w||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,x):(t.__proto__=x,s(t,u,"GeneratorFunction")),t.prototype=Object.create(S),t},e.awrap=function(t){return{__await:t}},I(O.prototype),s(O.prototype,c,(function(){return this})),e.AsyncIterator=O,e.async=function(t,r,n,o,a){void 0===a&&(a=Promise);var i=new O(l(t,r,n,o),a);return e.isGeneratorFunction(r)?i:i.next().then((function(t){return t.done?t.value:i.next()}))},I(S),s(S,u,"Generator"),s(S,i,(function(){return this})),s(S,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=A,T.prototype={constructor:T,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(P),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],c=i.completion;if("root"===i.tryLoc)return o("end");if(i.tryLoc<=this.prev){var u=n.call(i,"catchLoc"),s=n.call(i,"finallyLoc");if(u&&s){if(this.prev<i.catchLoc)return o(i.catchLoc,!0);if(this.prev<i.finallyLoc)return o(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return o(i.catchLoc,!0)}else{if(!s)throw Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return o(i.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===t||"continue"===t)&&a.tryLoc<=e&&e<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=t,i.arg=e,a?(this.method="next",this.next=a.finallyLoc,g):this.complete(i)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),g},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),P(r),g}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;P(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:A(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),g}},e}function g(t,e,r,n,o,a,i){try{var c=t[a](i),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function b(){var t=localStorage.getItem("apiKey");if(!t)throw new Error("API Key 未设置");return{apiKey:t,baseURL:"https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions"}}function w(t,e){return x.apply(this,arguments)}function x(){var t;return t=m().mark((function t(e,r){var n,o,a,i,c;return m().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return j("开始 AI 检查"),t.prev=1,n=b(),j("发送 AI 请求"),t.next=6,fetch(n.baseURL,{method:"POST",headers:{Authorization:"Bearer ".concat(n.apiKey),"Content-Type":"application/json"},body:JSON.stringify({model:"qwen-max",messages:[{role:"system",content:'你是一个专业的文档审核助手。你的任务是：\n1. 仔细检查文档中所有违反规则的内容\n2. 使用规则中定义的分数进行扣分\n3. 必须返回文档中的原文，不要概括或修改\n4.**在返回的结果中，"text" 字段应仅包含能够定位问题的简短句子或短语，不要包含过多的上下文。**\n5. 必须返回**严格符合要求的 JSON 格式**，不要添加任何额外的文本\n6.如果没有发现任何问题，返回 issues 为空的 JSON 对象\n7. 保持高度专注，不遗漏任何错误'},{role:"user",content:'请严格按照以下要求检查给定的文档片段是否违反规则：\n\n          - 仔细检查文档中所有违反规则的内容。\n          - 使用规则中定义的分数进行扣分。\n          - **必须仅返回 JSON 格式的内容，不要添加任何其他文本或说明**。\n          - **JSON 内容必须严格符合以下格式，不要包含额外的字符或控制符**。\n\n          返回格式要求（JSON 格式）：\n          ```json\n          {\n              "issues": [\n                  {\n                      "text": "文档中的原文，必须完整，不要修改或概括",\n                      "comment": "说明违反了什么规则，错在哪里",\n                      "score": 扣分分值（必须使用规则中定义的分数，数字类型）,\n                      "rule": "违反的具体规则原文"\n                  }\n              ],\n              "totalScore": 总扣分（所有 issues 的 score 之和，数字类型）\n          }\n          ```\n\n          规则：\n          '.concat(e,"\n\n          文档片段：\n          ").concat(r)}]})});case 6:if((o=t.sent).ok){t.next=12;break}return t.next=10,o.text();case 10:throw a=t.sent,new Error("HTTP error! status: ".concat(o.status,", message: ").concat(a));case 12:return t.next=14,o.json();case 14:if(i=t.sent,j("收到 AI 响应"),i.choices&&i.choices[0]&&i.choices[0].message){t.next=18;break}throw new Error("AI 响应格式不正确");case 18:return c=i.choices[0].message.content,j("AI 原始响应:\n".concat(c)),t.abrupt("return",v(c));case 23:if(t.prev=23,t.t0=t.catch(1),j("AI 调用错误: ".concat(t.t0.message)),!(retryCount<2)){t.next=35;break}return j("重试第 ".concat(retryCount+1," 次")),t.next=30,new Promise((function(t){return setTimeout(t,2e3)}));case 30:return t.next=32,w(e,r,retryCount+1);case 32:return t.abrupt("return",t.sent);case 35:throw new Error("AI 检查失败: ".concat(t.t0.message));case 36:case"end":return t.stop()}}),t,null,[[1,23]])})),x=function(){var e=this,r=arguments;return new Promise((function(n,o){var a=t.apply(e,r);function i(t){g(a,n,o,i,c,"next",t)}function c(t){g(a,n,o,i,c,"throw",t)}i(void 0)}))},x.apply(this,arguments)}function E(t){return E="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},E(t)}function L(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(t){if("string"==typeof t)return k(t,e);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?k(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,o=function(){};return{s:o,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,c=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return i=t.done,t},e:function(t){c=!0,a=t},f:function(){try{i||null==r.return||r.return()}finally{if(c)throw a}}}}function k(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}function S(){S=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",c=a.asyncIterator||"@@asyncIterator",u=a.toStringTag||"@@toStringTag";function s(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var a=e&&e.prototype instanceof m?e:m,i=Object.create(a.prototype),c=new T(n||[]);return o(i,"_invoke",{value:j(t,r,c)}),i}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var h="suspendedStart",p="suspendedYield",y="executing",v="completed",d={};function m(){}function g(){}function b(){}var w={};s(w,i,(function(){return this}));var x=Object.getPrototypeOf,L=x&&x(x(A([])));L&&L!==r&&n.call(L,i)&&(w=L);var k=b.prototype=m.prototype=Object.create(w);function I(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function O(t,e){function r(o,a,i,c){var u=f(t[o],t,a);if("throw"!==u.type){var s=u.arg,l=s.value;return l&&"object"==E(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,i,c)}),(function(t){r("throw",t,i,c)})):e.resolve(l).then((function(t){s.value=t,i(s)}),(function(t){return r("throw",t,i,c)}))}c(u.arg)}var a;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return a=a?a.then(o,o):o()}})}function j(e,r,n){var o=h;return function(a,i){if(o===y)throw Error("Generator is already running");if(o===v){if("throw"===a)throw i;return{value:t,done:!0}}for(n.method=a,n.arg=i;;){var c=n.delegate;if(c){var u=_(c,n);if(u){if(u===d)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=v,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=y;var s=f(e,r,n);if("normal"===s.type){if(o=n.done?v:p,s.arg===d)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(o=v,n.method="throw",n.arg=s.arg)}}}function _(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,_(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),d;var a=f(o,e.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,d;var i=a.arg;return i?i.done?(r[e.resultName]=i.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,d):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,d)}function N(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function P(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function T(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(N,this),this.reset(!0)}function A(e){if(e||""===e){var r=e[i];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,a=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return a.next=a}}throw new TypeError(E(e)+" is not iterable")}return g.prototype=b,o(k,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:g,configurable:!0}),g.displayName=s(b,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===g||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,s(t,u,"GeneratorFunction")),t.prototype=Object.create(k),t},e.awrap=function(t){return{__await:t}},I(O.prototype),s(O.prototype,c,(function(){return this})),e.AsyncIterator=O,e.async=function(t,r,n,o,a){void 0===a&&(a=Promise);var i=new O(l(t,r,n,o),a);return e.isGeneratorFunction(r)?i:i.next().then((function(t){return t.done?t.value:i.next()}))},I(k),s(k,u,"Generator"),s(k,i,(function(){return this})),s(k,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=A,T.prototype={constructor:T,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(P),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],c=i.completion;if("root"===i.tryLoc)return o("end");if(i.tryLoc<=this.prev){var u=n.call(i,"catchLoc"),s=n.call(i,"finallyLoc");if(u&&s){if(this.prev<i.catchLoc)return o(i.catchLoc,!0);if(this.prev<i.finallyLoc)return o(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return o(i.catchLoc,!0)}else{if(!s)throw Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return o(i.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===t||"continue"===t)&&a.tryLoc<=e&&e<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=t,i.arg=e,a?(this.method="next",this.next=a.finallyLoc,d):this.complete(i)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),d},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),P(r),d}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;P(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:A(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),d}},e}function I(t,e,r,n,o,a,i){try{var c=t[a](i),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function O(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var a=t.apply(e,r);function i(t){I(a,n,o,i,c,"next",t)}function c(t){I(a,n,o,i,c,"throw",t)}i(void 0)}))}}function j(t){var e=(new Date).toLocaleTimeString(),r=document.getElementById("debug-textarea");r&&(r.value+="[".concat(e,"] ").concat(t,"\n"),r.scrollTop=r.scrollHeight),console.log("[".concat(e,"] ").concat(t))}function _(t){var e=document.getElementById("check-button");e&&(e.disabled=!t)}function N(){j("载入规则按钮被点击");var t=document.getElementById("file-input");t?(t.value="",t.removeEventListener("change",T),t.addEventListener("change",T),j("触发文件选择对话框"),t.click()):j("错误：找不到文件输入元素")}function P(t){return new Promise((function(e,r){var n=new FileReader;n.onload=function(t){j("文件读取完成"),e(t.target.result)},n.onerror=function(){j("文件读取失败"),r(new Error("文件读取失败"))},n.readAsText(t,"UTF-8")}))}function T(t){return A.apply(this,arguments)}function A(){return(A=O(S().mark((function t(e){var r,n,o,a;return S().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(j("文件选择事件触发"),r=e.target.files[0]){t.next=5;break}return j("未选择文件"),t.abrupt("return");case 5:return j("选择的文件: ".concat(r.name,", 大小: ").concat(r.size," 字节")),j("开始读取文件"),t.prev=7,t.next=10,P(r);case 10:if(n=t.sent,!(o=document.getElementById("rules-input"))){t.next=19;break}j("正在设置输入框内容"),o.value=n,j("内容设置完成，当前长度: ".concat(o.value.length," 字符")),j("内容预览: ".concat(n.substring(0,100))),t.next=20;break;case 19:throw new Error("找不到规则输入框");case 20:t.next=27;break;case 22:t.prev=22,t.t0=t.catch(7),j("文件处理错误: ".concat(t.t0.message)),(a=document.getElementById("status"))&&(a.textContent="文件处理错误：".concat(t.t0.message));case 27:case"end":return t.stop()}}),t,null,[[7,22]])})))).apply(this,arguments)}function B(){return G.apply(this,arguments)}function G(){return G=O(S().mark((function t(){var e,r,n,o,a,i,c,s,l,f,p,y,v,d,m;return S().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e=document.getElementById("status"),r=document.getElementById("debug-textarea"),t.prev=2,e.textContent="",r&&(r.value="",j("=== 开始新的检查 ===")),_(!1),n=document.getElementById("rules-input").value){t.next=9;break}throw new Error("请先载入评分规则");case 9:return t.next=11,u();case 11:if((o=t.sent)&&0!==o.length){t.next=14;break}throw new Error("文档内容为空");case 14:return t.next=16,Word.run(function(){var t=O(S().mark((function t(e){var r;return S().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,r=e.document.comments){t.next=5;break}return j("无法获取批注集合"),t.abrupt("return");case 5:return r.load("items"),t.next=8,e.sync();case 8:if(!(r.items&&r.items.length>0)){t.next=15;break}return r.items.forEach((function(t){t.delete()})),t.next=12,e.sync();case 12:j("已删除 ".concat(r.items.length," 条现有批注")),t.next=16;break;case 15:j("文档中没有现有的批注");case 16:t.next=22;break;case 18:throw t.prev=18,t.t0=t.catch(0),j("删除批注时出错: ".concat(t.t0.message)),t.t0;case 22:case"end":return t.stop()}}),t,null,[[0,18]])})));return function(e){return t.apply(this,arguments)}}());case 16:j("总共有 ".concat(o.length," 个文本片段需要检查")),a=[],i=0,c=new Set,s=0;case 21:if(!(s<o.length)){t.next=33;break}return l=o[s],j("开始检查第 ".concat(s+1,"/").concat(o.length," 个片段，长度: ").concat(l.length," 字符")),t.next=26,w(n,l);case 26:if((f=t.sent)&&f.issues){p=L(f.issues);try{for(p.s();!(y=p.n()).done;)v=y.value,d=v.text+v.comment,c.has(d)||(c.add(d),a.push(v),i+=v.score||0)}catch(t){p.e(t)}finally{p.f()}}return t.next=30,new Promise((function(t){return setTimeout(t,2e3)}));case 30:s++,t.next=21;break;case 33:return t.next=35,Word.run(function(){var t=O(S().mark((function t(r){var n,o,c,u,s,l;return S().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=r.document.body,o=0,c=0,u=a;case 3:if(!(c<u.length)){t.next=12;break}return s=u[c],t.next=7,h(s,n,r);case 7:t.sent&&o++;case 9:c++,t.next=3;break;case 12:j(l="检查完成，发现 ".concat(o," 处错误，总扣分：").concat(i," 分")),e.textContent=l;case 15:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}());case 35:t.next=42;break;case 37:t.prev=37,t.t0=t.catch(2),j(m="检查过程出现错误：".concat(t.t0.message)),e.textContent=m;case 42:return t.prev=42,_(!0),F(),t.finish(42);case 46:case"end":return t.stop()}}),t,null,[[2,37,42,46]])}))),G.apply(this,arguments)}function F(){var t=document.getElementById("debug-textarea");if(t){var e=t.value,r=new Blob([e],{type:"text/plain;charset=utf-8"}),n=new Date,o=n.getFullYear()+"-"+("0"+(n.getMonth()+1)).slice(-2)+"-"+("0"+n.getDate()).slice(-2)+"_"+("0"+n.getHours()).slice(-2)+"-"+("0"+n.getMinutes()).slice(-2)+"-"+("0"+n.getSeconds()).slice(-2),a="log_".concat(o,".txt"),i=document.createElement("a");i.href=window.URL.createObjectURL(r),i.download=a,document.body.appendChild(i),i.click(),document.body.removeChild(i)}}r.d({},{R:function(){return j}}),window.onload=function(){var t=document.getElementById("debug-textarea");t&&(t.value="[初始化] 页面加载完成\n")},Office.onReady((function(t){if(t.host===Office.HostType.Word){o=document.getElementById("show-debug"),a=document.getElementById("debug-container"),o&&a&&("true"===localStorage.getItem("showDebug")&&(o.checked=!0,a.style.display="block"),o.addEventListener("change",(function(t){a.style.display=t.target.checked?"block":"none",localStorage.setItem("showDebug",t.target.checked)})));var e=document.getElementById("load-rules");e&&(e.onclick=N);var r=document.getElementById("check-button");r&&(r.onclick=B);var n=document.getElementById("settings-button");n&&(n.onclick=function(){var t=document.getElementById("settings-panel"),e=document.getElementById("apikey"),r=document.getElementById("chunk-size"),n=localStorage.getItem("apiKey");n&&(e.value=n);var o=localStorage.getItem("chunkSize")||"800";r.value=o,t.style.display="block"}),document.getElementById("cancel-settings").onclick=function(){document.getElementById("settings-panel").style.display="none"},document.getElementById("save-settings").onclick=function(){var t=document.getElementById("apikey").value.trim(),e=document.getElementById("chunk-size").value;if(t){localStorage.setItem("apiKey",t);var r=parseInt(e,10);if(isNaN(r)||r<800||r>2e3)return void alert("字符数必须在 800 到 2000 之间");localStorage.setItem("chunkSize",r),document.getElementById("settings-panel").style.display="none";var n=document.getElementById("status");n&&(n.textContent="设置已保存",setTimeout((function(){n.textContent=""}),3e3))}},j("=== Word 加载项初始化完成 ===")}var o,a})),window.log=j}(),new URL(r(58394),r.b)}();
//# sourceMappingURL=taskpane.js.map